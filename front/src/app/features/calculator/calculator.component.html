<div class="card p-4 shadow-sm">
  <h4 class="mb-3 text-center">ğŸ§® Calculadora de Materiales</h4>

  <div class="row mb-3">
    <div class="col-md-4">
      <label>ğŸ§± Material</label>
      <select [(ngModel)]="input.materialType" class="form-select">
        <option *ngFor="let m of materials" [ngValue]="m">{{ m }}</option>
      </select>
    </div>

    <div class="col-md-3">
      <label>Ancho (m)</label>
      <input type="number" [(ngModel)]="input.width" class="form-control" placeholder="Ej: 5.2" min="0.1" />
    </div>

    <div class="col-md-3">
      <label>Alto (m)</label>
      <input type="number" [(ngModel)]="input.height" class="form-control" placeholder="Ej: 4.8" min="0.1" />
    </div>

    <div class="col-md-2 d-flex align-items-end">
      <button class="btn btn-success w-100" (click)="calculate()" [disabled]="loading">
        {{ loading ? 'Calculando...' : 'Calcular' }}
      </button>
    </div>
  </div>

  <div *ngIf="result" class="alert alert-info mt-3 text-center">
    <p class="mb-1"><strong>Superficie total:</strong> {{ result.squareMeters | number:'1.2-2' }} mÂ²</p>
    <p class="mb-1"><strong>Precio total:</strong> {{ result.totalPrice | currency:'ARS':'symbol':'1.0-0' }}</p>

    <button class="btn btn-primary mt-3" (click)="sendToBudget()">Agregar al Presupuesto</button>
  </div>

  <!-- âœ… Vista previa de materiales agregados -->
  <div *ngIf="previewItems.length > 0" class="mt-4">
    <h5 class="text-center text-secondary">ğŸ§¾ Materiales Agregados</h5>
    <ul class="list-group mt-2">
      <li *ngFor="let item of previewItems; let i = index" class="list-group-item d-flex justify-content-between">
        <span>{{ item.description }} â€” {{ item.quantity | number:'1.2-2' }} mÂ² x {{ item.unitPrice | currency:'ARS' }}</span>
        <button class="btn btn-sm btn-danger" (click)="removeItem(i)">âœ–</button>
      </li>
    </ul>

    <div class="mt-3 text-center">
      <h5 class="fw-bold">ğŸ’° Total estimado: {{ totalGeneral | currency:'ARS':'symbol':'1.0-0' }}</h5>
    </div>

    <div class="text-center mt-3">
      <button class="btn btn-outline-primary" (click)="goToBudget()">â¡ï¸ Ir al Presupuesto</button>
    </div>
  </div>

  <div class="text-center mt-3">
    <button *ngIf="result" class="btn btn-outline-secondary" (click)="reset()">Reiniciar</button>
  </div>
</div>
